<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Hello, wdh</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
		<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.css">
		
		<style>	
			.input_image_div {
				padding: 0;
				overflow: hidden;
				width:	200px;
			}
			
			.input_image {
				width:	100%;
				height: 200px;
				overflow: hidden;
			}
			
<<<<<<< HEAD
<<<<<<< HEAD
			.input_image_div_lg {
				padding: 0;
				margin: 40px;
				overflow: hidden;
				width:	300px;
			}
			
			.input_image_lg {
				width:	100%;
				height: 300px;
				overflow: hidden;
			}
			
			.file {
=======
			 .file {
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
=======
			 .file {
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
				position: relative;
				width: 100%;
				height: 100%;
				z-index: 2;
				opacity: 0; 
			}
			
			.input_image:hover {
				cursor: hand;
			}
			
			.icon {
				position: relative;
				top: -100%;
				width: 100%;
				height: 100%;
			}
			
			.row_line {
				width: 100%;
				text-align: center;
			}
			
			.wdh_margin {
				margin: 20px 10px;
<<<<<<< HEAD
<<<<<<< HEAD
				padding-left: 30px;
=======
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
=======
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
			}
			
			:text {
				height: 38px;
				
			}
<<<<<<< HEAD
<<<<<<< HEAD
			
			.wdh_font {
				line-height: 38px;
				font-size: 1.4em;
				margin-right:10px;
			}
			
			.spc {
				margin-left: 40px;
			}
			
			.h-divider{
				margin:10px 0;
				height:1px;
				width:100%;
				border-top:1px solid gray;
			}
			
			#info_win {
				position: absolute;
=======
			.wdh_font {
				line-height: 38px;
				font-size: 1.4em;
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
=======
			.wdh_font {
				line-height: 38px;
				font-size: 1.4em;
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
			}
		</style>
	</head>
	
	<body'>
<<<<<<< HEAD
<<<<<<< HEAD
		<div class='container-fluid wdh_margin mx-auto'>
			
			<div class='row'>
				<h2>商品信息维护</h2>
				<select id='cur_status' class="selectpicker col-lg-1 offset-lg-9">
					<option>上架</option>
					<option>下架</option>
				</select>
			</div>
			
			</br>
			
			<form id="g_info_1" class="d-block" method="post">
				<div class='row wdh_margin'>
					<label class="form-label wdh_font">编号:</label>
					<input id='pid' type='text' class="form-control col-lg-2" name='pid'/>
					
					<label class="form-label wdh_font offset-lg-1 ">店铺ID:</label>
					<input id='store_id' type='text' class="form-control col-lg-2" name='store_id'/>
					
					<label class="form-label wdh_font offset-lg-1 ">产品名称:</label>
					<input id='goods_name' type='text' class="form-control col-lg-2" name='name'/>
				</div>

				<div class='row wdh_margin form-group'>
					<label class="form-label wdh_font">类别:</label>
					<select id='category' class="selectpicker col-lg-2" name='category'>
						<option>A</option>
						<option>B</option>
						<option>C</option>
					</select>
					
					<label class="form-label wdh_font offset-lg-1">子类别:</label>
					<select id='sub_category' class="selectpicker col-lg-2" name='sub_category'>
						<option>SA</option>
						<option>SB</option>
						<option>SC</option>
					</select>
				</div>				

				</br>
				<button id='g_info_1_submit' type="submit" class="mx-auto btn btn-primary btn-block btn-flat col-lg-4">提 交</button>
			</form>
			</br>
			<p class="h-divider"></p>
			</br>
			
			<form id="g_info_2" class="d-block" method="post">
				<label class="form-label wdh_font">规格-星选价-市场价:</label>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_1'/>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_2'/>
				</div>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_3'/>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_4'/>
				</div>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_5'/>
					<input type='text' class="spc form-control col-lg-4" placeholder='规格名称-星选价-市场价' name='sp_6'/>
				</div>
				<button id='g_info_2_submit' type="submit" class="mx-auto btn btn-primary btn-block btn-flat col-lg-4">提 交</button>
			</form>
			
			</br>
			<p class="h-divider"></p>
			</br>
			
			<div class='row wdh_margin form-group'>
				<div class='col-lg-7'>
					<div class='row'>
						<label class="form-label wdh_font">简介:</label>
						<textarea id='g_intro' class='col-lg-10' rows=10 name="goods_intro" placeholder='产品简介'></textarea>
					</div>
					</br>
					<div class='row'>
						<button id='g_intro_btn' class="btn btn-primary btn-block btn-flat col-lg-3 offset-lg-8">提 交</button>
					</div>
				</div>
				
				<div class='input_image_div offset-lg-2'>
					<div class='input_image'>
						<input type="file" id="icon_file" class="btn btn-default file" />
						<img class="img-rounded icon" />
					</div>
					</br>
					<p class='row_line'>
						<button id='up_icon' type='button' class='col-lg-6'>图标上传</button>
					</p>
				</div>
			</div>
			
			</br>
			<p class="h-divider"></p>
			</br>
			
			<form id="indexs" class="d-block" method="post">
				<label class="form-label wdh_font">星选指数:</label>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-2" placeholder='美味指数' name='index_d'/>
					<input type='text' class="spc form-control col-lg-2" placeholder='新鲜指数' name='index_f'/>
				</div>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-2" placeholder='便捷指数' name='index_c'/>
					<input type='text' class="spc form-control col-lg-2" placeholder='健康指数' name='index_h'/>
				</div>
				<div class='row wdh_margin form-group'>
					<input type='text' class="spc form-control col-lg-2" placeholder='流行指数' name='index_p'/>
				</div>
				<button id='index_submit' type="submit" class="mx-auto btn btn-primary btn-block btn-flat col-lg-4">提 交</button>
			</form>
			
			</br>
			<p class="h-divider"></p>
			</br>		
			
			<div class='row wdh_margin form-group'>		
				<div class='mx-auto row'>
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" id="d_m_file"  multiple="multiple" class="btn btn-default file" />
							<img id='d_img_1' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=1>上传产品详图-1(可多选)</button>
						</p>
					</div>
					
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" class="btn btn-default file d_image" />
							<img id='d_img_2' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=2>上传产品详图-2</button>
						</p>
					</div>
					
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" class="btn btn-default file d_image" />
							<img id='d_img_3' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=3>上传产品详图-3</button>
						</p>
					</div>
				</div>
				
				<div class='mx-auto row'>
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" class="btn btn-default file d_image" />
							<img id='d_img_4' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=4>上传产品详图-4</button>
						</p>
					</div>
					
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" class="btn btn-default file d_image" />
							<img id='d_img_5' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=5>上传产品详图-5</button>
						</p>
					</div>
					
					<div class='input_image_div_lg'>
						<div class='input_image_lg'>
							<input type="file" class="btn btn-default file d_image" />
							<img id='d_img_6' class="img-rounded icon" />
						</div>
						</br>
						<p class='row_line'>
							<button type='button' class='col-lg-10 d_image_btn' user_d=6>上传产品详图-6</button>
						</p>
					</div>
				</div>
				
			</div>
		</div>
		
		<!-- alert-danger -->
		<div id='info_win' class="alert alert-success alert-dismissible fade show">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<strong>成功!</strong>。
		</div>
  
  
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
		
		
		<script>
			var pid = 7001;
			var store_id = 7000;
			$('#info_win').hide();
			
			$( function () {
				
				$('#icon_file').change( function ( e ) {
					var show_img = $(this).next( 'img' );
					
					var file = this.files[0];
					var reader = new FileReader();
					reader.readAsDataURL( file );
					reader.onload = function () { show_img.attr('src', this.result); };
				} );
				
				$('#g_info_1_submit').click( function( e ) {
					e.preventDefault();
					var data = $('#g_info_1').serialize();					
					var url = '/api/goods/set/g_info_1';
					
					$.post( url, data, function( res ) {
						show_res_info( e, res );
					} );
	
				} );
	
				$('#cur_status').change( function( e ) {
					var on_off = $(this).val();
					var old_st = '', st = '';
								
					if ( on_off=='上架' ) {
						st = 'on';
						old_st = '下架';
					}
					else {
						st = 'off';
						old_st = '上架';
					}
					
					$(this).attr( 'pre_s', old_st );
					
					var url = '/api/goods/set/status/' + pid + '/' + st;
					$.getJSON( url, function( res ) {
						if (res.res=='OK')
							$('#cur_status').val( on_off );
						else
							$('#cur_status').val( old_st );
					} )
					.fail( function( res ) {
						var old_st = $('#cur_status').attr( 'pre_s' );
						$('#cur_status').val( old_st );
					} );
					
				});
				
				
				$('#g_info_2_submit').click( function ( e ) {
					e.preventDefault();
					var data = $('#g_info_2').serialize();
					var url = '/api/goods/set/sps/' + pid;
					$.post( url, data, function( res ) {
						show_res_info( e, res );
					} );
					
				} );
				
				$('#g_intro_btn').click( function( e ) {
					var data = $('#g_intro').val();
					var url =  '/api/goods/set/introduction/' + pid;
					$.post( url, {'data':data}, function( res ) {
						show_res_info( e, res );
					} );
				} );
				
				$('#pid').keydown( function( e ) {
					if ( e.keyCode==13 ) {
						var pid = $(this).val();
						
					}
				} );
			} );
			
			
			function show_res_info( e, res ) {
				res = $.parseJSON( res );
				var info_win = $( '#info_win' );
				info_win.css( {'top':e.pageY-100,'left':e.pageX-80 } );
				if (res.res=='OK') {
					info_win.removeClass( 'alert-danger' );
					info_win.addClass( 'alert-success' );
					info_win.children('strong').text( '上传成功' );
				}
				else {
					info_win.removeClass( 'alert-success' );
					info_win.addClass( 'alert-danger' );
					info_win.children('strong').text( res.reason );
				}
				info_win.show().fadeOut( 3000 );
			};
			
			
			$('#up_icon').click( function( e ) {
				var formData = new FormData();
				formData.append( 'file', $('#icon_file')[0].files[0] )
				$.ajax( { url:'/api/images/upload/icon', type: 'POST', data: formData,  processData: false, contentType: false,
							success : function( res ) { 
								show_res_info( e, res );
							}, 
							error : function( res ) { 
								show_res_info( e, res );
							} 
						} );
			} );
			
			
			var reader_list = [], THE_FS = []
			for ( var i=0; i<6; i++ )
				reader_list.push( new FileReader() );
			
			
			$('#d_m_file').change( function( e ) {
				THE_FS = this.files;
				$.each( THE_FS, function( i,v ) {
					var id = 'd_img_' + (i+1);	
					var show_img = $('#'+id);
					reader_list[i].readAsDataURL( v );
					reader_list[i].onload = function () { show_img.attr('src', this.result); };
				} );
				
			} );
			
			
			$('.d_image').change( function( e ) {
				var reader = new FileReader();
				var file = this.files[0];
				var show_img = $(this).next('img');
				reader.onload = function () { show_img.attr('src', this.result); };
				reader.readAsDataURL( file );
			} );
			
			
			$('.d_image_btn').click( function( e ) {
				var the_input = $(this).parents( 'div.input_image_div_lg' ).find( ':file' );
				var btn_i = $(this).attr( 'user_d' );
				var update_btn_p = $(this).parent();
				var url = '/api/images/upload/' + pid + '/' + store_id + '/details'
				
				if ( update_btn_p.next('p.check_font').length==0 ) {
					var note = $( "<p class='check_font' style='text-align:center;'><i class='fas fa-check-circle' style='margin-left:20px;font-size:2em;'></i></p>" );
					update_btn_p.after( note );
					note.hide();
				}
							
				if ( the_input[0].files.length==0 ) {
					var formData = new FormData();
					formData.append( 'file', THE_FS[btn_i-1] );
					formData.append( 'index', btn_i );
										
					$.ajax( { url:url, type: 'POST', data: formData,  processData: false, contentType: false,
							success : function( res ) { 
								show_res_info( e, res ); 
								res = $.parseJSON( res );
								if (res.res=='OK') {
									var note = update_btn_p.next( 'p.check_font' );
									note.children('i').addClass( 'alert-success' );
									note.show().fadeOut( 8000 );
								}
							}, 
							error : function( res ) { 
								show_res_info( e, res );
								res = $.parseJSON( res );
								if (res.res=='OK') {
									var note = update_btn_p.next( 'p.check_font' );
									note.children('i').addClass( 'alert-danger' );
									note.show().fadeOut( 8000 );
								}
							} 
						} );
				}
				else {
					if ( btn_i==1 )			
						$.each( THE_FS, function(i, v) {
							var formData = new FormData();
							formData.append( 'file', v );
							formData.append( 'index', i+1 );
							
							var update_btn_p = $('button[user_d='+(i+1)+']').parent();
							var note = update_btn_p.next( 'p.check_font' );
							if ( note.length==0 ) {
								note = $( "<p class='check_font' style='text-align:center;'><i class='fas fa-check-circle' style='margin-left:20px;font-size:2em;'></i></p>" );
								update_btn_p.after( note );
								note.hide();
							}
								
							$.ajax( { url:url, type: 'POST', data: formData,  processData: false, contentType: false,
								success : function( res ) {
									show_res_info( e, res );
									res = $.parseJSON( res );
									if (res.res=='OK') {
										note.children('i').addClass( 'alert-success' );
										note.show().fadeOut( 8000 );
									}
								}, 
								error : function( res ) { 
									show_res_info( e, res );
									res = $.parseJSON( res );
									if (res.res=='OK') {
										note.children('i').addClass( 'alert-danger' );
										note.show().fadeOut( 8000 );
									}
								} 
							} );
							
						} );
						
					else {
						var formData = new FormData();
						formData.append( 'file', the_input[0].files[0] );
						formData.append( 'index', btn_i );
						var note = update_btn_p.next( 'p.check_font' );
						
						$.ajax( { url:url, type: 'POST', data: formData,  processData: false, contentType: false,
								success : function( res ) {
									show_res_info( e, res );
									res = $.parseJSON( res );
									if (res.res=='OK') {
										note.children('i').addClass( 'alert-success' );
										note.show().fadeOut( 8000 );
									}
								}, 
								error : function( res ) { 
									show_res_info( e, res );
									res = $.parseJSON( res );
									if (res.res=='OK') {
										note.children('i').addClass( 'alert-danger' );
										note.show().fadeOut( 8000 );
									}
								} 
						} );	
					}
					
				}
			
=======
		<div class='container-fluid wdh_margin'>
			<h2>商品信息维护</h2>
			<div class='row wdh_margin form-group'>
				<label class="form-label wdh_font">ID:&nbsp;&nbsp;&nbsp;&nbsp;</label><input id='pid' type='text' class="form-control col-lg-1"/>
			</div>
			
			<div class='input_image_div'>
				<div class='input_image'>
					<input type="file" id="icon_file" class="btn btn-default file" />
					<img class="img-rounded icon" />
				</div>
				</br>
				<p class='row_line'>
					<button id='up_icon' type='button' class='col-lg-6'>上传</button>
				</p>
			</div>
		</div>
			
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.js"></script>
		<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/extensions/print/bootstrap-table-print.min.js"></script>
		
		<script>
			$( function () {
			
				$(':file').change( function( e ) {
					var reader = new FileReader();
					var file = this.files[0];					
					
					reader.onload = function () {
						$('.icon').attr( 'src', reader.result );
					};
					reader.readAsDataURL( file );
				} );
			
			
				$('#up_icon').click( function() {
					var formData = new FormData();
					formData.append( 'file', $('#icon_file')[0].files[0] );

					$.ajax( { url:'/upload', type: 'POST', data: formData,  processData: false, contentType: false,
						success : function( res ) { 
							$('#order_res_show').html( res );
						}, 
						error : function( res ) { 
							$('#order_res_show').html( 'error' );
						} 
					} );
					
				} );

							
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
=======
		<div class='container-fluid wdh_margin'>
			<h2>商品信息维护</h2>
			<div class='row wdh_margin form-group'>
				<label class="form-label wdh_font">ID:&nbsp;&nbsp;&nbsp;&nbsp;</label><input id='pid' type='text' class="form-control col-lg-1"/>
			</div>
			
			<div class='input_image_div'>
				<div class='input_image'>
					<input type="file" id="icon_file" class="btn btn-default file" />
					<img class="img-rounded icon" />
				</div>
				</br>
				<p class='row_line'>
					<button id='up_icon' type='button' class='col-lg-6'>上传</button>
				</p>
			</div>
		</div>
			
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.js"></script>
		<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/extensions/print/bootstrap-table-print.min.js"></script>
		
		<script>
			$( function () {
			
				$(':file').change( function( e ) {
					var reader = new FileReader();
					var file = this.files[0];					
					
					reader.onload = function () {
						$('.icon').attr( 'src', reader.result );
					};
					reader.readAsDataURL( file );
				} );
			
			
				$('#up_icon').click( function() {
					var formData = new FormData();
					formData.append( 'file', $('#icon_file')[0].files[0] );

					$.ajax( { url:'/upload', type: 'POST', data: formData,  processData: false, contentType: false,
						success : function( res ) { 
							$('#order_res_show').html( res );
						}, 
						error : function( res ) { 
							$('#order_res_show').html( 'error' );
						} 
					} );
					
				} );

							
>>>>>>> df1c32b90130a29f005e29f6e272c9b506439a1f
			} );
		</script>

	</body>

</html>